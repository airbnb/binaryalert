rule win_sasfis_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2021-10-07"
        version = "1"
        description = "Detects win.sasfis."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.sasfis"
        malpedia_rule_date = "20211007"
        malpedia_hash = "e5b790e0f888f252d49063a1251ca60ec2832535"
        malpedia_version = "20211008"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 261810 16 6e 6f }
            // n = 4, score = 100
            //   261810               | sbb                 byte ptr es:[eax], dl
            //   16                   | push                ss
            //   6e                   | outsb               dx, byte ptr [esi]
            //   6f                   | outsd               dx, dword ptr [esi]

        $sequence_1 = { 6e a6 8e03 6a1a d515 94 72a0 }
            // n = 7, score = 100
            //   6e                   | outsb               dx, byte ptr [esi]
            //   a6                   | cmpsb               byte ptr [esi], byte ptr es:[edi]
            //   8e03                 | mov                 es, word ptr [ebx]
            //   6a1a                 | push                0x1a
            //   d515                 | aad                 0x15
            //   94                   | xchg                eax, esp
            //   72a0                 | jb                  0xffffffa2

        $sequence_2 = { 880c24 8d642450 e9???????? 60 }
            // n = 4, score = 100
            //   880c24               | mov                 byte ptr [esp], cl
            //   8d642450             | lea                 esp, dword ptr [esp + 0x50]
            //   e9????????           |                     
            //   60                   | pushal              

        $sequence_3 = { 56 66c1f604 f9 d3e7 55 0fbee9 }
            // n = 6, score = 100
            //   56                   | push                esi
            //   66c1f604             | sal                 si, 4
            //   f9                   | stc                 
            //   d3e7                 | shl                 edi, cl
            //   55                   | push                ebp
            //   0fbee9               | movsx               ebp, cl

        $sequence_4 = { 656c 65637a55 0c52 106f74 61 727a 7610 }
            // n = 7, score = 100
            //   656c                 | insb                byte ptr es:[edi], dx
            //   65637a55             | arpl                word ptr gs:[edx + 0x55], di
            //   0c52                 | or                  al, 0x52
            //   106f74               | adc                 byte ptr [edi + 0x74], ch
            //   61                   | popal               
            //   727a                 | jb                  0x7c
            //   7610                 | jbe                 0x12

        $sequence_5 = { 685d2cc711 9c 897c2404 660fb6f9 }
            // n = 4, score = 100
            //   685d2cc711           | push                0x11c72c5d
            //   9c                   | pushfd              
            //   897c2404             | mov                 dword ptr [esp + 4], edi
            //   660fb6f9             | movzx               di, cl

        $sequence_6 = { e9???????? 9c 882424 6841623191 894c2404 }
            // n = 5, score = 100
            //   e9????????           |                     
            //   9c                   | pushfd              
            //   882424               | mov                 byte ptr [esp], ah
            //   6841623191           | push                0x91316241
            //   894c2404             | mov                 dword ptr [esp + 4], ecx

        $sequence_7 = { 2b0416 6c 46 6c 61 }
            // n = 5, score = 100
            //   2b0416               | sub                 eax, dword ptr [esi + edx]
            //   6c                   | insb                byte ptr es:[edi], dx
            //   46                   | inc                 esi
            //   6c                   | insb                byte ptr es:[edi], dx
            //   61                   | popal               

        $sequence_8 = { 6553 260416 41 706f 7226 0330 }
            // n = 6, score = 100
            //   6553                 | push                ebx
            //   260416               | add                 al, 0x16
            //   41                   | inc                 ecx
            //   706f                 | jo                  0x71
            //   7226                 | jb                  0x28
            //   0330                 | add                 esi, dword ptr [eax]

        $sequence_9 = { 307c0b42 16 27 52 b3c6 727c 4e }
            // n = 7, score = 100
            //   307c0b42             | xor                 byte ptr [ebx + ecx + 0x42], bh
            //   16                   | push                ss
            //   27                   | daa                 
            //   52                   | push                edx
            //   b3c6                 | mov                 bl, 0xc6
            //   727c                 | jb                  0x7e
            //   4e                   | dec                 esi

    condition:
        7 of them and filesize < 8060928
}